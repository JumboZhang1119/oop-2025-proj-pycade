<body>
  <div id="transfer" align="center">
    <div class="emscripten" id="status">Downloading...</div>
    <div class="emscripten">
      <progress value="0" max="100" id="progress"></progress>
    </div>
  </div>

  <div id="ume-hint" style="
    position: absolute;
    top: 40%;
    width: 100%;
    text-align: center;
    font-size: 32px;
    color: navy;
    font-family: sans-serif;
    z-index: 10;">
    👉 點一下畫面開始遊戲 👈
  </div>

  <canvas class="emscripten" id="canvas" width="1px" height="1px"
          oncontextmenu="event.preventDefault()" tabindex="1"></canvas>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let unlocked = false;

      const tryUnlock = () => {
        try {
          if (typeof AudioContext !== 'undefined') {
            const ctx = new AudioContext();
            if (ctx.state === "suspended") {
              ctx.resume().then(() => {
                console.log("[AudioContext] resumed");
              });
            }
          }

          if (
            typeof platform !== "undefined" &&
            typeof platform.window !== "undefined" &&
            typeof platform.window.MM !== "undefined"
          ) {
            platform.window.MM.UME = true;
            console.log("[platform.window.MM] UME set to true");
            unlocked = true;

            // ✅ 清除提示文字
            document.getElementById("ume-hint")?.remove();
          }
        } catch (e) {
          console.warn("Unlock attempt failed", e);
        }
      };

      const interactionHandler = () => {
        const interval = setInterval(() => {
          if (!unlocked) {
            tryUnlock();
          } else {
            clearInterval(interval);
          }
        }, 200);

        document.removeEventListener("mousedown", interactionHandler);
        document.removeEventListener("keydown", interactionHandler);
        document.removeEventListener("touchstart", interactionHandler);
      };

      document.addEventListener("mousedown", interactionHandler);
      document.addEventListener("keydown", interactionHandler);
      document.addEventListener("touchstart", interactionHandler);
    });
  </script>
</body>
